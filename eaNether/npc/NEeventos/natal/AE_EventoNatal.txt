arug_cas05,321,78,0	script	Dama de Pedra#xmas	111,{
	specialeffect2 338;
	set #AE_EvtPt, #AE_EvtPt+25;	
	dispbottom "[Resgate ao Espírito de Natal]";
	dispbottom "- Você adquiriu 25 Pontos de Evento."; 
	dispbottom "- Atualmente, você possui "+#AE_EvtPt+" Pontos de Evento.";
	set @NatalRand, rand(1,3);
	if(@NatalRand == 1) getitem 5384,1;
	if(@NatalRand == 2) getitem 5390,1;
	if(@NatalRand == 3) getitem 5382,1;
	getitem 12208,1;
	getitem 12210,1;
	getitem 20006,1;
	getitem 20007,1;
	getitem 20022,1;
	warp "prontera",150,150;
	if($AE_NatalEvent > 0){
		announce "Milley: Fragmentos do Espírito de Natal foram recuperados! Aparentemente, "+getmapusers("arug_cas05")+" chegaram ao ponto final do desafio!",0;
		sleep2 5000;
		announce "Milley: Obrigado a todos que ajudaram, mas, nem todos os Fragmentos foram recuperados ainda, espero a ajuda de vocês nas próximas tentativas!",0;
		set $AE_NatalEvent,0;
	}
	end;
}

arug_cas05,141,42,0	script	Portal Final#xmas	45,1,1,{
	end;
	
OnTouch:
	warp "arug_cas05",391,77;
}

xmas_dun01,62,36,0	script	Portal Sombrio#01::DarkPortal	723,1,1,{
	end;

OnTouch:
	if(countitem(7876) > 0){
		if(rand(1,3) == 3){
			set #AE_EvtPt, #AE_EvtPt+10;
			dispbottom "[Resgate ao Espírito de Natal]";
			dispbottom "- Você adquiriu 10 Pontos de Evento."; 
			dispbottom "- Atualmente, você possui "+#AE_EvtPt+" Pontos de Evento.";
			delitem 7876,countitem(7876);
			warp "job_wiz",114,169;
		}
		dispbottom "- Mesmo com a Chave Dourada, o Teletransporte não deu certo, melhor tentar novamente...";
		warp "Random",0,0;
		end;
	}
	warp "Random",0,0;
	end;
}

xmas_dun01,100,167,0	duplicate(DarkPortal)	Portal Sombrio#02	723,1,1
xmas_dun01,136,111,0	duplicate(DarkPortal)	Portal Sombrio#03	723,1,1
xmas_dun01,220,30,0	duplicate(DarkPortal)	Portal Sombrio#04	723,1,1
xmas_dun01,235,80,0	duplicate(DarkPortal)	Portal Sombrio#05	723,1,1
xmas_dun01,78,80,0	duplicate(DarkPortal)	Portal Sombrio#06	723,1,1

-	script	AntoniosPortais	-1,{

OnEventoLiga:
	announce "Milley: Atenção todos, o Resgate do Espírito de Natal irá começar!",0;
	sleep2 5000;
	announce "Milley: Neste exato momento, cerca de 20 Fantasmas Natalinos etão invadindo o Segundo Andar da Fábrica de Brinquedos, detenham-nos!",0;
	sleep2 5000;
	announce "Milley: Utilizem a Chave Dourada que eles carregam para tentar entrar nas Dimensões Obscuras do Primeiro Andar da Fábrica de Brinquedos.",0;
	set $AE_NatalEvent,1;
	set $AE_NatalMaze1,rand(1,4);
	set $AE_NatalMaze2,rand(1,4);
	set $AE_NatalMaze3,rand(1,4);
	set $AE_NatalMobs,25;	
	set $AE_NatalRune,4;
	monster "xmas_dun02",0,0,"Fantasma Natalino",2701,25,"AntoniosPortais::OnAntonioKill";
	monster "arug_cas05",65,171,"Estilhaço Natalino",2702,1,"AntoniosPortais::OnEstilhacoKill";
	monster "arug_cas05",212,149,"Estilhaço Natalino",2702,1,"AntoniosPortais::OnEstilhacoKill";
	monster "arug_cas05",139,293,"Estilhaço Natalino",2702,1,"AntoniosPortais::OnEstilhacoKill";
	monster "arug_cas05",144,293,"Estilhaço Natalino",2702,1,"AntoniosPortais::OnEstilhacoKill";
	monster "arug_cas05",0,0,"Encarnação Natalina",2703,30,"AntoniosPortais::OnBossKill";
	hideoffnpc "Portal Sombrio#01";
	hideoffnpc "Portal Sombrio#02";
	hideoffnpc "Portal Sombrio#03";
	hideoffnpc "Portal Sombrio#04";
	hideoffnpc "Portal Sombrio#05";
	hideoffnpc "Portal Sombrio#06";
	enablenpc "Maze#a1";
	enablenpc "Maze#a2";
	enablenpc "Maze#a3";
	enablenpc "Maze#a4";
	enablenpc "Maze#b1";
	enablenpc "Maze#b2";
	enablenpc "Maze#b3";
	enablenpc "Maze#b4";
	enablenpc "Maze#c1";
	enablenpc "Maze#c2";
	enablenpc "Maze#c3";
	enablenpc "Maze#c4";
	end;

OnBossKill:
	set #AE_EvtPt, #AE_EvtPt+5;
	dispbottom "[Resgate ao Espírito de Natal]";
	dispbottom "- Você adquiriu 5 Pontos de Evento."; 
	dispbottom "- Atualmente, você possui "+#AE_EvtPt+" Pontos de Evento.";
	if(rand(1,20) == 1) getitem 20011,1;
	end;

OnEstilhacoKill:
	if($AE_NatalRune == 1){
		dispbottom "[Resgate ao Espírito de Natal]";
		dispbottom "- Você adquiriu 20 Pontos de Evento."; 
		dispbottom "- Atualmente, você possui "+#AE_EvtPt+" Pontos de Evento.";	
		mapannounce "arug_cas05","Milley: "+strcharinfo(0)+" destruiu o último dos Estilhaços!",0;
		sleep2 5000;
		mapannounce "arug_cas05","Milley: Agora corram! Procurem a passagem e recuperem os Fragmentos do Espírito de Natal!",0;
		enablenpc "Portal Final#xmas";
		end;
	}
	set $AE_NatalRune, $AE_NatalRune - 1;
	set #AE_EvtPt, #AE_EvtPt+20;
	dispbottom "[Resgate ao Espírito de Natal]";
	dispbottom "- Você adquiriu 20 Pontos de Evento."; 
	dispbottom "- Atualmente, você possui "+#AE_EvtPt+" Pontos de Evento.";	
	mapannounce "arug_cas05","Milley: "+strcharinfo(0)+" destruiu um dos Estilhaços, restam ainda mais "+$AE_NatalRune+"!",0;
	end;
	
	
OnAntonioKill:
	if(countitem(7876) < 1){
		rentitem 7876,3600;
		dispbottom "Com a Chave Dourada, é possível tentar entrar nos Portais Sombrios do Primeiro Andar da Fábrica de Brinquedos";
	}
	set $AE_NatalMobs, $AE_NatalMobs - 1;
	set #AE_EvtPt, #AE_EvtPt+5;
	dispbottom "[Resgate ao Espírito de Natal]";
	dispbottom "- Você adquiriu 5 Pontos de Evento."; 
	dispbottom "- Atualmente, você possui "+#AE_EvtPt+" Pontos de Evento.";	
	mapannounce "xmas_dun01","Milley: "+strcharinfo(0)+" derrotou um Fantasma Natalino, restam ainda mais "+$AE_NatalMobs+"!",0;
	mapannounce "xmas_dun02","Milley: "+strcharinfo(0)+" derrotou um Fantasma Natalino, restam ainda mais "+$AE_NatalMobs+"!",0;
	end;
}

-	script	AnunciadorNatal	-1,{

OnEventoComeca:
	if($AE_Natal >= 200){
		announce "Milley: Atenção todos! Eu sou Milley, da cidade de Lutie, com a ajuda das pessoas de Prontera, juntamos 1.000 Pontos de Evento.",0;
		sleep2 5000;
		announce "Milley: Agora, com esses Poderes, mandaremos 4 vezes ao dia, aventureiros para tentar resgatar os Fragmentos do Espírito de Natal",0;
		sleep2 5000;
		announce "Milley: Portanto, fiquem atentos ao meu chamado e fiquem atentos as minhas ordens! Vocês poderão ser chamados à qualquer momento!",0;
		end;
	}	

OnClock0920:
OnClock1320:
OnClock1720:
OnClock2120:
OnStartaEvento:
	if($AE_Natal >= 200){
		donpcevent "AntoniosPortais::OnEventoLiga";
		end;
	}	
	
OnClock0940:
OnClock1340:
OnClock1740:
OnClock2140:
	if($AE_NatalEvent > 0){
		announce "Milley: Restam apenas 5 Minutos para que meus Poderes deixem de funcionar!",0;
		sleep2 5000;
		announce "Milley: É o tempo que resta para que os Fragmentos do Espírito de Natal sejam recuperados!",0;
	}	
	end;
	
OnClock0945:
OnClock1345:
OnClock1745:
OnClock2145:
	if($AE_NatalEvent > 0){
		announce "Milley: Infelizmente, todos que tentaram ajudar não foram capazes de chegar ao fim à tempo, teremos que trazê-los de volta!",0;
		sleep2 5000;
		announce "Milley: Obrigado à todos que tentaram, espero que possam tentar novamente em breve!",0;
	}
		
OnInit:	
	mapwarp "job_wiz","prontera",150,150;
	mapwarp "arug_cas05","prontera",150,150;
	killmonster "xmas_dun02","AntoniosPortais::OnEventoLiga";
	killmonster "arug_cas05","AntoniosPortais::OnEstilhacoKill";
	killmonster "arug_cas05","AntoniosPortais::OnBossKill";
	set $AE_NatalEvent,0;
	set $AE_NatalMaze1,0;
	set $AE_NatalMaze2,0;
	set $AE_NatalMaze3,0;
	set $AE_NatalMobs,0;
	set $AE_NatalRune,0;
	hideonnpc "Portal Sombrio#01";
	hideonnpc "Portal Sombrio#02";
	hideonnpc "Portal Sombrio#03";
	hideonnpc "Portal Sombrio#04";
	hideonnpc "Portal Sombrio#05";
	hideonnpc "Portal Sombrio#06";
	disablenpc "Maze#a1";
	disablenpc "Maze#a2";
	disablenpc "Maze#a3";
	disablenpc "Maze#a4";
	disablenpc "Maze#b1";
	disablenpc "Maze#b2";
	disablenpc "Maze#b3";
	disablenpc "Maze#b4";
	disablenpc "Maze#c1";
	disablenpc "Maze#c2";
	disablenpc "Maze#c3";
	disablenpc "Maze#c4";
	disablenpc "Portal Final#xmas";
}

prontera,155,169,3	script	Milley#xmas	713,{
	if($AE_Natal >= 200){
		if(AE_NatalHat > 0){
			mes "^0000FF[Milley]^000000";
			mes "Mandaremos equipes nos seguintes horários:";
			mes "• ^0000FF09^000000:^000000FF20^000000                • ^0000FF13^000000:^000000FF20^000000";
			mes "• ^0000FF17^000000:^000000FF20^000000                • ^0000FF21^000000:^000000FF20^000000";
			mes "Boas festas!";
			close;
		}
		mes "^0000FF[Milley]^000000";
		mes "Muito obrigado por ajudar.";
		mes "Pegue este presente que servirá para comemorar as festividades ^0000FFNatalinas^000000, ele deve durar apenas esse fim de ano.";
		next;
		
		rentitem 20021,432000;
		set AE_NatalHat,1;
		mes "^0000FF[Milley]^000000";
		mes "Boas festas!";
		close;
	}
	if(#AE_Natal > 0){
		mes "^0000FF[Milley]^000000";
		mes "Muito obrigado! Até agora, temos ^0000FF"+$AE_Natal+"^000000 Pontos de Evento.";
		mes "Vou esperar outras pessoas que possam contribuir";
		close;
	}
	mes "^0000FF[Milley]^000000";
	mes ((Sex)?"^0000FF":"^FF0000")+strcharinfo(0)+"^000000...";
	mes "Esse é seu nome, não é?";
	mes "Preciso de sua ajuda...";
	mes "O ^0000FFEspírito do Natal^000000 fora tomado de ^0000FFLutie^000000 e seus poderes estão sendo tomados.";
	next;

	mes "^0000FF[Milley]^000000";
	mes "Os ^0000FFSábios^000000 estão usando seus ^0000FFPoderes^000000 para conter o derretimento das ^0000FFMontanhas^000000, então, não temos forças para resgatar a ^0000FFAlma Natalina^000000, por isso, peço ajuda.";
	next;

	mes "^0000FF[Milley]^000000";
	mes "Para mandar ^0000FFEquipes^000000 em busca dos ^0000FFFragmentos^000000 do ^0000FFEspírito de Natal^000000 preciso dos ^0000FFPoderes^000000 de ^0000FF200 Pontos de Evento^000000!";
	if(#AE_EvtPt < 10){
		mes "Quando possuir ^0000FF10^000000, por favor, nos ajude!";
		close;
	}
	mes "Poderia ajudar com ^0000FF10^000000?";	
	next;
	
	switch(select("• Sim","• Não")){
		case 1:
			set #AE_EvtPt, #AE_EvtPt - 10;
			set $AE_Natal, $AE_Natal + 10;
			set #AE_Natal,1;
			if($AE_Natal < 200){
				mes "^0000FF[Milley]^000000";
				mes "Muito obrigado! Até agora, temos ^0000FF"+$AE_Natal+"^000000 Pontos de Evento.";
				mes "Vou esperar outras pessoas que possam contribuir";
				close;
			}
			mes "^0000FF[Milley]^000000";
			mes "Muito bem!";
			mes "Finalmente conseguimos a quantidade necessária de ^0000FFPontos de Evento^000000, agora, periódicamente, até o dia do ^0000FFNatal^000000, poderemos mandar equipes, fique aguardando o meu chamado!";
			close2;
			donpcevent "AntoniosPortais::OnEventoLiga";
			end;
			
		case 2:
			close;
	}
	
OnWhisperGlobal:
	if (getgmlevel() < 40) end;
	if (compare(@whispervar0$,"on")) donpcevent "AnunciadorNatal::OnOnStartaEvento";
	end;	
}

arug_cas05	mapflag	nobranch
arug_cas05	mapflag	noicewall
arug_cas05	mapflag	nomemo
arug_cas05	mapflag	noreturn
arug_cas05	mapflag	noteleport
arug_cas05	mapflag	nowarpto
arug_cas05	mapflag	nowarp
arug_cas05	mapflag	pvp	off
arug_cas05	mapflag	nosave
job_wiz	mapflag	nobranch
job_wiz	mapflag	noicewall
job_wiz	mapflag	nomemo
job_wiz	mapflag	noreturn
job_wiz	mapflag	noteleport
job_wiz	mapflag	nowarpto
job_wiz	mapflag	nowarp
job_wiz	mapflag	pvp	off
job_wiz	mapflag	nosave